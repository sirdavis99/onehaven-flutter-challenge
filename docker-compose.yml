services:
  onehaven-app:
    build: .
    volumes:
      - ./:/app
      - flutter_pub_cache:/root/.pub-cache
      - ./android-sdk:/opt/android-sdk-linux
      - ./gradle-cache:/root/.gradle
    environment:
      - ADB_SERVER_SOCKET=tcp:host.docker.internal:5037
      - ANDROID_SDK_ROOT=/opt/android-sdk-linux
      - ANDROID_HOME=/opt/android-sdk-linux
    tty: true
    stdin_open: true
  mock-api:
    image: node:18-alpine
    command: ["sh", "-lc", "npx -y json-server@0.17.4 --watch /data/db.json --host 0.0.0.0 --port 3000"]
    volumes:
      - ./tools/mock-server/db.json:/data/db.json:ro
    ports:
      - "3000:3000"
volumes:
  flutter_pub_cache:
